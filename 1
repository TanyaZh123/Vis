w.series = w.series.map(s => {
  if (s.name === 'discount') {
    return {
      ...s,
      color: 'rgb(239,68,68)', // –∫—Ä–∞—Å–Ω—ã–π
      data: s.data.map(d => ({
        ...d,
        value: -Math.abs(d.value),
        formattedValue: String(Math.abs(d.value))
      })),
      label: {
        ...s.label,
        show: true,
        position: 'bottom',
        formatter: p => Math.abs(p.value)
      }
    };
  }
  if (s.name === '–í—ã—Ä—É—á–∫–∞') {
    return {
      ...s,
      color: 'rgb(34,197,94)', // –∑–µ–ª—ë–Ω—ã–π
      data: s.data.map(d => ({
        ...d,
        value: Math.abs(d.value),
        formattedValue: String(Math.abs(d.value))
      })),
      label: {
        ...s.label,
        show: true,
        position: 'top',
        formatter: p => Math.abs(p.value)
      }
    };
  }

  return s;
});

w.yAxis = {
  ...w.yAxis,

  axisLabel: {
    ...w.yAxis.axisLabel,
    formatter: function (v) {
      return Math.abs(v);   // —É–±–∏—Ä–∞–µ–º –º–∏–Ω—É—Å—ã —Å –æ—Å–∏
    }
  },

  splitLine: {
    show: true
  }
};

const hiredSeries = w.series.find(s => s.name === '–í—ã—Ä—É—á–∫–∞');
const firedSeries = w.series.find(s => s.name === 'discount');

const netData = hiredSeries.data.map((d, i) => {
  const hired = Math.abs(d.value);
  const fired = Math.abs(firedSeries.data[i].value);

  return {
    ...d,
    value: hired - fired
  };
});

w.tooltip = {
  ...w.tooltip,
  trigger: 'axis',
  formatter: function (params) {
    let hired = 0;
    let fired = 0;
    let net = 0;

    params.forEach(p => {
      if (p.seriesName === '–ü—Ä–∏–Ω—è—Ç—ã–µ') hired = Math.abs(p.value);
      if (p.seriesName === '–£–≤–æ–ª–µ–Ω–Ω—ã–µ') fired = Math.abs(p.value);
      if (p.seriesName === '–ß–∏—Å—Ç—ã–π –ø—Ä–∏—Ä–æ—Å—Ç') net = p.value;
    });

    return `
      ${params[0].axisValue}<br/>
      üü¢ –ü—Ä–∏–Ω—è—Ç—ã–µ: <b>${hired}</b><br/>
      üî¥ –£–≤–æ–ª–µ–Ω–Ω—ã–µ: <b>${fired}</b><br/>
      ‚ûñ‚ûï –ß–∏—Å—Ç—ã–π –ø—Ä–∏—Ä–æ—Å—Ç: <b>${net}</b>
    `;
  }
};

w.series.forEach(s => {
  if (s.type === 'bar') {
    s.markLine = {
      silent: true,
      data: [{ yAxis: 0 }]
    };
  }
});


w.series.push({
  type: 'line',
  name: '–ß–∏—Å—Ç—ã–π –ø—Ä–∏—Ä–æ—Å—Ç',
  data: netData,
  smooth: true,
  symbol: 'circle',
  symbolSize: 6,
  lineStyle: {
    width: 2
  },
  label: {
    show: false
  },
  z: 10 // —á—Ç–æ–±—ã –ª–∏–Ω–∏—è –±—ã–ª–∞ –ø–æ–≤–µ—Ä—Ö –±–∞—Ä–æ–≤
});


ColumnChartRender({
    general: w.general,
    xAxis: w.xAxis,
    yAxis: w.yAxis,
    series: w.series,
    legend: w.legend,
    tooltip: w.tooltip,
    grid: w.grid,
    dataZoom: w.dataZoom
});
