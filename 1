const positiveData = w.series[0]?.data || [];
const negativeData = w.series[1]?.data || [];

// Вычисляем границы для оси Y
const maxPositive = Math.max(...positiveData);
const maxNegative = Math.max(...negativeData);
const maxValue = Math.max(maxPositive, maxNegative);

const config = {
  general: w.general,
  xAxis: w.xAxis,
  yAxis: {
    ...w.yAxis,
    type: 'value',
    min: -maxValue * 1.2, // ноль посередине
    max: maxValue * 1.2,
    axisLabel: {
      ...w.yAxis?.axisLabel,
      formatter: function(value) {
        // Показываем абсолютные значения
        return Math.abs(Math.round(value));
      }
    }
  },
  series: w.series.flatMap((series, index) => {
    if (index === 1) {
      // Серия вниз
      return [{
        ...series,
        type: 'bar',
        data: series.data.map(value => -value), // инвертируем
        label: {
          ...series.label,
          show: series.label?.show !== false,
          position: 'bottom',
          formatter: function(params) {
            return Math.abs(params.value);
          }
        }
      }];
    }
    // Серия вверх
    return [{
      ...series,
      type: 'bar',
      label: {
        ...series.label,
        position: 'top'
      }
    }];
  }),
  legend: w.legend,
  tooltip: {
    ...w.tooltip,
    formatter: function(params) {
      // Кастомный тултип с абсолютными значениями
      let result = params[0].name || '';
      params.forEach(item => {
        const value = Math.abs(item.value);
        const sign = item.value >= 0 ? '↑' : '↓';
        result += `<br/>${item.marker} ${item.seriesName}: ${sign} ${value}`;
      });
      return result;
    }
  }
};

ColumnChartRender(config);
